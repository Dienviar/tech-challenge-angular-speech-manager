<div class="d-flex flex-column gap-4">
  @defer {
    <app-search-speech (searchSpeech)="onSpeechSearch($event)" />
  }

  @if (totalPages() > 0) {
    <div class="row">
      <div [ngClass]="{ 'col-4': windowWidth() > windowBreakPoint, 'col-12': windowWidth() < windowBreakPoint }" class="d-flex flex-column gap-3">
        @for (item of _speechService.getSpeechDataSubjectPaginated(currentPage(), pageSize) | async; track item.id) {
          <div
            (keydown.enter)="onCardClick(item.id)"
            (keydown.space)="onCardClick(item.id)"
            tabindex="0"
            role="button"
            class="card"
            [class.selected]="selectedSpeechId() === item.id"
            (click)="onCardClick(item.id)"
          >
            <div class="card-body">
              <h5 class="card-title">{{ item.subject }}</h5>
              <div class="date-container">
                <span class="card-text">Author: {{ item.author }}</span>
                <span class="card-text">Speech Date: {{ item.speech_date | date: 'MMMM d, y, h:mm a' }}</span>
              </div>

              <div class="date-container mt-2">
                <span class="card-text">Date Created: {{ item.date_created | date: 'MMMM d, y, h:mm a' }}</span>
                <span class="card-text">Date Updated: {{ (item.date_updated | date: 'MMMM d, y, h:mm a') ?? 'N/A' }}</span>
              </div>
            </div>
          </div>
        }

        <div class="d-flex justify-content-end mt-1">
          <nav aria-label="Page navigation">
            <ul class="pagination">
              <li class="page-item" [class.disabled]="currentPage() === 1">
                <button class="page-link" (click)="onPageChange(currentPage() - 1)" aria-label="Previous">
                  <span aria-hidden="true">&laquo;</span>
                </button>
              </li>

              @for (item of [].constructor(totalPages()); track i; let i = $index) {
                <li class="page-item" [ngClass]="{ active: currentPage() === i + 1 }">
                  <button class="page-link" (click)="onPageChange(i + 1)">{{ i + 1 }} {{ item }}</button>
                </li>
              }

              <li class="page-item" [class.disabled]="currentPage() === totalPages()">
                <button class="page-link" (click)="onPageChange(currentPage() + 1)" aria-label="Next">
                  <span aria-hidden="true">&raquo;</span>
                </button>
              </li>
            </ul>
          </nav>
        </div>
      </div>
      <div class="col-8">
        @if (windowWidth() > windowBreakPoint) {
          <ng-container [ngTemplateOutlet]="speechFormTemp"></ng-container>
        } @else {
          <app-modal position="center" padding="padded" (modalClose)="clearSelectedSpeechId()">
            <div class="w-100">
              <ng-container [ngTemplateOutlet]="speechFormTemp"></ng-container>
            </div>
          </app-modal>
        }
      </div>
    </div>
  } @else {
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">No speech record has been found in the system</h5>
        <button type="button" routerLink="/create" class="btn btn-success">Create Speech</button>
      </div>
    </div>
  }
</div>

<ng-template #speechFormTemp>
  @if (selectedSpeechId() !== -1) {
    <app-upsert-speech [speechId]="selectedSpeechId()" (speechDeleted)="onSpeechDeleted()" />
  } @else {
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">There is no selected speech to view</h5>
      </div>
    </div>
  }
</ng-template>
