<div class="d-flex flex-column gap-4">
  @defer {
    <app-search-speech (searchSpeech)="onSpeechSearch($event)" />
  }

  @if (totalPages() > 0) {
    <div class="row">
      <div
        [ngClass]="{ 'col-4 overflow-y-auto': windowWidth() > windowBreakPoint, 'col-12': windowWidth() < windowBreakPoint }"
        [style.height]="windowWidth() > windowBreakPoint ? windowHeight() + 'px' : 'h-auto'"
        class="d-flex flex-column gap-3"
      >
        @for (item of paginatedSpeechData$ | async; track item.id) {
          <div #speechItem (keydown.enter)="onCardClick(item.id)" tabindex="0" class="card" [class.selected]="selectedSpeechId() === item.id" (click)="onCardClick(item.id)">
            <div class="card-body">
              <h5 class="card-title">{{ item.subject }}</h5>
              <div class="date-container">
                <span class="card-text">Author: {{ item.author }}</span>
                <span class="card-text">Speech Date: {{ item.speech_date | date: 'MMMM d, y, h:mm a' }}</span>
              </div>

              <div class="date-container mt-2">
                <span class="card-text">Date Created: {{ item.date_created | date: 'MMMM d, y, h:mm a' }}</span>
                <span class="card-text">Date Updated: {{ (item.date_updated | date: 'MMMM d, y, h:mm a') ?? 'N/A' }}</span>
              </div>
            </div>
          </div>
        }

        <div class="w-100 position-relative d-flex justify-content-center gap-2">
          <ul class="pagination py-2">
            <li class="page-item" [class.disabled]="(currentPage$ | async) === 1">
              <button class="page-link" (click)="onPageChange(currentPage$.value - 1)">
                <span>&laquo;</span>
              </button>
            </li>
          </ul>

          <nav class="overflow-x-auto">
            <ul class="pagination p-2">
              @for (item of [].constructor(totalPages()); track i; let i = $index) {
                <li class="page-item" [ngClass]="{ active: (currentPage$ | async) === i + 1 }">
                  <button class="page-link" (click)="onPageChange(i + 1)">{{ i + 1 }} {{ item }}</button>
                </li>
              }
            </ul>
          </nav>

          <ul class="pagination py-2">
            <li class="page-item" [class.disabled]="(currentPage$ | async) === totalPages()">
              <button class="page-link" (click)="onPageChange(currentPage$.value + 1)">
                <span>&raquo;</span>
              </button>
            </li>
          </ul>
        </div>
      </div>

      @if (windowWidth() > windowBreakPoint) {
        <div class="col-8 overflow-y-auto" [style.height]="windowHeight() + 'px'">
          <ng-container [ngTemplateOutlet]="speechFormTemp"></ng-container>
        </div>
      } @else {
        <app-modal position="center" padding="padded" (modalClose)="clearSelectedSpeechId()">
          <div class="w-100">
            <ng-container [ngTemplateOutlet]="speechFormTemp"></ng-container>
          </div>
        </app-modal>
      }
    </div>
  } @else {
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">No speech record has been found in the system</h5>
        <button type="button" routerLink="/create" class="btn btn-success">Create Speech</button>
      </div>
    </div>
  }
</div>

<ng-template #speechFormTemp>
  @if (selectedSpeechId()) {
    <app-upsert-speech [speechId]="selectedSpeechId()" (speechDeleted)="onSpeechDeleted()" />
  } @else {
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">There is no selected speech to view</h5>
      </div>
    </div>
  }
</ng-template>
